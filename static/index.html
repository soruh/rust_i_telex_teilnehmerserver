<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link href="/static/main.css" rel="stylesheet" />
    <script src="/static/api.js"></script>
    <title>Teilnehmerliste</title>
  </head>
  <body>
    <a href="/static/new.html">neuen Eintrag anlegen</a>
    <a href="/static/login.html">einloggen</a>
    <table id="table"></table>
    <script>
      function main(is_logged_in) {
        let table = document.getElementById("table");

        getPublicEntries(function(err, entries) {
          if (entries.length == 0) return;

          let keys = is_logged_in
            ? [
                "number",
                "name",
                "extension",
                "ipaddress",
                "hostname",
                "client_type",
                "port",
                "disabled"
              ]
            : [
                "number",
                "name",
                "extension",
                "ipaddress",
                "hostname",
                "client_type",
                "port"
              ];

          let tr = document.createElement("tr");

          for (let key of keys) {
            let th = document.createElement("th");
            th.innerHTML = key;
            tr.append(th);
          }

          table.append(tr);

          for (let entry of entries) {
            let tr = document.createElement("tr");

            tr.className = "row";
            tr.onclick = () => {
              window.location = "/static/entry.html?number=" + entry.number;
            };

            for (let key of keys) {
              let td = document.createElement("td");

              switch (key) {
                case "address":
                  td.innerHTML = ~[2, 4, 5].indexOf(entry.client_type)
                    ? entry.ipaddress
                    : entry.hostname;
                  break;

                case "extension":
                  td.innerHTML = stringifyExtension(entry.extension) || "-";
                  break;

                default:
                  td.innerHTML = entry[key];
              }

              tr.append(td);
            }

            table.append(tr);
          }
        });
      }
    </script>
    <script src="/static/main.js"></script>
  </body>
</html>
